{"version":3,"sources":["pages/Staff/ApplyList/applyList.jsx"],"names":["getApplyByPageNum","Staff","Repeal","RefMore","DeleteApply","getMarkById","applyList","props","handleWatchMark","val","a","_id","result","Modal","info","title","content","data","handleModic","console","log","history","push","pathname","state","handleDelete","code","message","setTimeout","window","location","reload","handleReal","listData","obj","find","value","status","statusText","setState","handleRef","Apply","msg","handleGetList","pageNum","forEach","key","total","pageSize","client","action","text","El","onClick","type","columns","dataIndex","align","render","this","receptionTurn","off","className","pagination","defaultCurrent","defaultPageSize","hideOnSinglePage","responsive","onChange","dataSource","Component"],"mappings":"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","file":"static/js/31.c7ba5022.chunk.js","sourcesContent":["import React, { Component } from \"react\";\r\nimport { Table, Space, Button, Modal } from \"antd\";\r\nimport { message } from \"../../../api\";\r\nimport { Apply, receptionTurn } from \"../../../socket\";\r\nimport { Staff } from \"../../../axios\";\r\nimport \"./applyList.scss\";\r\nconst { getApplyByPageNum, Repeal, RefMore, DeleteApply, getMarkById } = Staff;\r\nclass applyList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.client = \"\";\r\n    this.action = (text) => {\r\n      let El = \"\";\r\n      switch (text.status) {\r\n        case \"-1\":\r\n          El = (\r\n            <Space>\r\n              <Button onClick={() => this.handleModic(text)}>修改</Button>\r\n              <Button onClick={() => this.handleDelete(text)} type=\"danger\">\r\n                删除\r\n              </Button>\r\n              <Button onClick={() => this.handleRef(text)} type=\"primary\">\r\n                重新提交\r\n              </Button>\r\n            </Space>\r\n          );\r\n          break;\r\n        case \"0\":\r\n          El = (\r\n            <Space>\r\n              <Button onClick={() => Apply(text)}>催办</Button>\r\n              <Button type=\"danger\" onClick={() => this.handleReal(text)}>\r\n                撤销\r\n              </Button>\r\n            </Space>\r\n          );\r\n          break;\r\n        case \"1\":\r\n          El = (\r\n            <Button type=\"danger\" onClick={() => this.handleReal(text)}>\r\n              撤销\r\n            </Button>\r\n          );\r\n          break;\r\n        default:\r\n          El = (\r\n            <Space>\r\n              <Button onClick={() => this.handleWatchMark(text)}>\r\n                查看理由\r\n              </Button>\r\n              <Button onClick={() => this.handleDelete(text)} type=\"danger\">\r\n                删除\r\n              </Button>\r\n            </Space>\r\n          );\r\n      }\r\n      return El;\r\n    };\r\n    this.columns = [\r\n      {\r\n        title: \"开始时间\",\r\n        dataIndex: \"time\",\r\n        align: \"center\",\r\n        key: \"createTime\",\r\n      },\r\n      {\r\n        title: \"天数\",\r\n        dataIndex: \"num\",\r\n        align: \"center\",\r\n        key: \"num\",\r\n      },\r\n      {\r\n        title: \"类型\",\r\n        dataIndex: \"type\",\r\n        align: \"center\",\r\n        key: \"type\",\r\n      },\r\n      {\r\n        title: \"状态\",\r\n        align: \"center\",\r\n        dataIndex: \"statusText\",\r\n        key: \"statusText\",\r\n      },\r\n      {\r\n        title: \"操作\",\r\n        align: \"center\",\r\n        render: (text) => this.action(text),\r\n        key: \"func\",\r\n      },\r\n    ];\r\n    this.state = {\r\n      listData: [],\r\n      total: 0,\r\n    };\r\n  }\r\n  //点击查看理由\r\n  handleWatchMark = async (val) => {\r\n    const result = await getMarkById(val._id);\r\n    Modal.info({\r\n      title: \"查看理由\",\r\n      content: result.data[\"mark\"],\r\n    });\r\n  };\r\n\r\n  //修改申请\r\n  handleModic = async (val) => {\r\n    console.log(await DeleteApply(val._id));\r\n    this.props.history.push({\r\n      pathname: \"/index/Apply\",\r\n      state: { info: val },\r\n    });\r\n  };\r\n  //删除申请\r\n  handleDelete = async (val) => {\r\n    const result = await DeleteApply(val._id);\r\n    if (result.code === \"200\") {\r\n      message(\"删除成功\", \"success\");\r\n      setTimeout(() => {\r\n        window.location.reload();\r\n      }, 2000);\r\n    }\r\n  };\r\n  //撤销申请\r\n  handleReal = async (val) => {\r\n    const result = await Repeal(val._id);\r\n    const { listData } = this.state;\r\n    const obj = listData.find((value) => val._id === value._id);\r\n    obj.status = \"-1\";\r\n    obj.statusText = \"已撤销\";\r\n    if (result.code === \"200\") {\r\n      val.status = \"-1\";\r\n      this.setState({\r\n        listData,\r\n      });\r\n      message(\"撤销成功\", \"success\");\r\n    }\r\n  };\r\n  //重新提交\r\n  handleRef = async (val) => {\r\n    const { listData } = this.state;\r\n    const result = await RefMore(val._id);\r\n    if (result.code === \"200\") {\r\n      const obj = listData.find((value) => val._id === value._id);\r\n      obj.status = \"0\";\r\n      this.setState({\r\n        listData,\r\n      });\r\n      message(\"提交成功\", \"success\");\r\n      Apply(val);\r\n    } else {\r\n      message(result.msg);\r\n    }\r\n  };\r\n  //获取通知\r\n  handleGetList = async (pageNum) => {\r\n    const result = await getApplyByPageNum(pageNum);\r\n    if (result.data) {\r\n      result.data.forEach((value) => {\r\n        if (value.status === \"0\") {\r\n          value.statusText = \"审核中\";\r\n        } else if (value.status === \"-1\") {\r\n          value.statusText = \"已撤销\";\r\n        } else if (value.status === \"-2\") {\r\n          value.statusText = \"已驳回\";\r\n        } else if (value.status === \"1\") {\r\n          value.statusText = \"已通过\";\r\n        }\r\n        value.key = value._id;\r\n      });\r\n      this.setState({ listData: result.data, total: result.pageSize });\r\n    }\r\n  };\r\n  //生命周期-挂载时\r\n  componentDidMount() {\r\n    this.handleGetList(1);\r\n    //webSocket即时消息\r\n    this.client = receptionTurn((data) => {\r\n      if (data) {\r\n        setTimeout(() => {\r\n          window.location.reload();\r\n        }, 2000);\r\n      }\r\n    });\r\n  }\r\n  //生命周期-卸载时\r\n  componentWillUnmount() {\r\n    this.client.off();\r\n  }\r\n  render() {\r\n    return (\r\n      <section className=\"applyList-container\">\r\n        <section className=\"applyList-header\">我的申请</section>\r\n        <section className=\"applyList-mainer\">\r\n          <Table\r\n            pagination={{\r\n              defaultCurrent: 1,\r\n              defaultPageSize: 6,\r\n              hideOnSinglePage: true,\r\n              responsive: true,\r\n              total: this.state.total,\r\n              onChange: (pageNum) => {\r\n                this.handleGetList(pageNum);\r\n              },\r\n              // current:this.state.current\r\n            }}\r\n            dataSource={this.state.listData}\r\n            columns={this.columns}\r\n          />\r\n        </section>\r\n      </section>\r\n    );\r\n  }\r\n}\r\n\r\nexport default applyList;\r\n"],"sourceRoot":""}